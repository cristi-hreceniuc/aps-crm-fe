<!-- views/partials/datagrid.ejs -->
<section class="card"
         data-grid
         data-grid-id="<%= (typeof gridId !== 'undefined' ? gridId : (typeof grid_id !== 'undefined' ? grid_id : '')) %>">

  <div class="dg-toolbar">
    <div class="dg-left">
      <h2 class="dg-title"><%= title %></h2>
      <% if (typeof subtitle !== 'undefined' && subtitle) { %>
        <div class="muted"><%= subtitle %></div>
      <% } %>
    </div>
    <div class="dg-right">
      <input class="dg-search"
             type="search"
             inputmode="search"
             autocomplete="off"
             spellcheck="false"
             placeholder="<%= (typeof searchPlaceholder !== 'undefined' && searchPlaceholder) ? searchPlaceholder : 'Caută…' %>"
             aria-label="Căutare" />
    </div>
  </div>

  <% if (typeof selectable !== 'undefined' && selectable) { %>
    <div class="dg-select-all-bar">
      <button type="button"
              class="btn-mini outline dg-select-all-btn"
              title="Selectează toate înregistrările din tabel"
              aria-live="polite">
        <span class="dg-select-all-label">Selectează tot:</span>
        <span class="dg-select-count" aria-live="polite">0</span>
      </button>
      <span class="dg-select-all-info muted">
        Folosește această opțiune pentru a genera XML cu toate înregistrările.
      </span>
      <!-- Mobile-only bulk actions (date + generate) - shown right under select all -->
      <div class="dg-bulk-mobile">
        <input type="date" class="dg-bulk-date-mobile" aria-label="Data borderou">
        <button type="button" class="btn-mini dg-bulk-btn-mobile" disabled>Generează XML</button>
      </div>
    </div>
  <% } %>

  <div class="dg-scroll">
    <table class="dg-table">
      <colgroup>
        <% if (typeof selectable !== 'undefined' && selectable) { %>
          <col class="dg-col dg-col-select">
        <% } %>
        <% (columns || []).forEach(function(c){ %>
          <col class="dg-col dg-col-<%= c.key %>">
        <% }) %>
      </colgroup>

      <thead>
        <tr>
          <% if (typeof selectable !== 'undefined' && selectable) { %>
            <th class="col-select">
              <label class="dg-check" title="Selectează toate">
                <input type="checkbox" class="dg-check-all">
                <span class="box"></span>
                <span class="vh">Selectează toate</span>
              </label>
            </th>
          <% } %>

          <% (columns || []).forEach(function(c){ %>
            <th class="col-<%= c.key %>" data-key="<%= c.key %>" <% if (c.sortable) { %> data-sortable="true" <% } %>>
              <div class="th-inner">
                <span class="th-label"><%= c.label %></span>
                <% if (c.sortable) { %>
                  <button class="dg-sort" title="Sortează" aria-hidden="true">
                    <svg class="icon-svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3 4.5h14.25M3 9h9.75M3 13.5h5.25m5.25-.75L17.25 9l-4.5 4.5-4.5-4.5L9.75 9" />
                    </svg>
                  </button>
                <% } %>
              </div>
            </th>
          <% }) %>
        </tr>
      </thead>

      <tbody class="dg-body"><!-- rows from JS --></tbody>
    </table>
  </div>

<div class="dg-footer">
  <% if (typeof selectable !== 'undefined' && selectable) { %>
    <div class="dg-bulk">
      <input type="date" class="dg-bulk-date" aria-label="Data borderou">
      <button type="button" class="btn-mini outline dg-bulk-btn" disabled>Generează XML</button>
    </div>
  <% } else { %>
    <div class="dg-spacer"></div>
  <% } %>

  <div class="dg-pager">
    <button type="button" class="btn-mini outline dg-prev">
      <svg class="icon-svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
      </svg>
      Înapoi
    </button>
    <span class="dg-pages">—</span>
    <button type="button" class="btn-mini outline dg-next">
      Înainte
      <svg class="icon-svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
      </svg>
    </button>
  </div>

  <div class="dg-spacer"></div>
  
</div>


  <!-- Config JSON -->
  <script type="application/json" class="dg-config">
    <%- JSON.stringify({
      gridId:   (typeof gridId   !== 'undefined' ? gridId   : (typeof grid_id !== 'undefined' ? grid_id : '')),
      endpoint: (typeof endpoint !== 'undefined' ? endpoint : ''),
      endpointSearch: (typeof endpointSearch !== 'undefined' ? endpointSearch : null),
      pageSize: (typeof pageSize !== 'undefined' ? pageSize : 10),
      columns:  (typeof columns  !== 'undefined' ? columns  : []),
      api:      (typeof api      !== 'undefined' ? api      : {}),
      response: (typeof response !== 'undefined' ? response : {}),
      auth:     (typeof auth     !== 'undefined' ? auth     : null),
      selectable: !!(typeof selectable !== 'undefined' && selectable),
      userRole: (typeof user !== 'undefined' && user ? user.userRole : null)
    }) %>
  </script>
  <script>
  (function(){
    if(window.innerWidth>1024)return;
    var fix=function(){
      // Reset ALL container heights
      var containers='.app,.content-shell,.card,[data-grid],.dg-scroll,.dg-table,.dg-table tbody,.dg-table thead,.dg-table colgroup';
      document.querySelectorAll(containers).forEach(function(el){
        el.style.setProperty('display','block','important');
        el.style.setProperty('height','auto','important');
        el.style.setProperty('min-height','0','important');
        el.style.setProperty('max-height','none','important');
        el.style.setProperty('flex','none','important');
      });
      // Make scroll container completely invisible
      document.querySelectorAll('.dg-scroll').forEach(function(el){
        el.style.setProperty('border','0','important');
        el.style.setProperty('border-width','0','important');
        el.style.setProperty('background','none','important');
        el.style.setProperty('background-color','transparent','important');
        el.style.setProperty('box-shadow','none','important');
        el.style.setProperty('padding','0','important');
        el.style.setProperty('margin','0','important');
        el.style.setProperty('overflow','visible','important');
        el.style.setProperty('border-radius','0','important');
      });
      // Completely hide thead and colgroup
      document.querySelectorAll('.dg-table thead,.dg-table colgroup').forEach(function(el){
        el.style.setProperty('display','none','important');
        el.style.setProperty('visibility','hidden','important');
        el.style.setProperty('height','0','important');
        el.style.setProperty('position','absolute','important');
        el.style.setProperty('left','-9999px','important');
      });
      // Fix table
      document.querySelectorAll('.dg-table').forEach(function(el){
        el.style.setProperty('table-layout','auto','important');
        el.style.setProperty('border-collapse','collapse','important');
        el.style.setProperty('border-spacing','0','important');
      });
    };
    fix();
    document.addEventListener('DOMContentLoaded',fix);
    window.addEventListener('load',fix);
    setTimeout(fix,10);
    setTimeout(fix,50);
    setTimeout(fix,100);
    setTimeout(fix,250);
    setTimeout(fix,500);
    setTimeout(fix,1000);
    if(window.MutationObserver){
      new MutationObserver(function(){fix();}).observe(document.body,{childList:true,subtree:true});
    }
  })();
  </script>
</section>
