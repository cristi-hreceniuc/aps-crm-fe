<!doctype html>
<html lang="ro">

<head>
  <title>APS CRM</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>
    <%= typeof title !=='undefined' ? title + ' · ' : '' %>APS CRM
  </title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700;800&display=swap"
    rel="stylesheet">

  <link rel="icon" type="image/png" href="/img/aps-logo-small.png" sizes="32x32">
  <link rel="apple-touch-icon" href="/img/aps-logo-small.png">

  <link rel="stylesheet" href="/css/base.css?v=4" />
  <link rel="stylesheet" href="/css/layout.css?v=4" />
  <link rel="stylesheet" href="/css/sidebar.css?v=4" />
  <link rel="stylesheet" href="/css/components.css?v=4" />
  <link rel="stylesheet" href="/css/icons.css?v=4" />
  <link rel="stylesheet" href="/css/dark-theme.css?v=4">

  <!-- DataGrid CSS separat (după components ca să aibă prioritate) -->
  <link rel="stylesheet" href="/css/datagrid.css?v=4" />
  <link rel="stylesheet" href="/css/responsive.css?v=4" />
  <link rel="stylesheet" href="/css/datagrid.mobile.css?v=4" />
  <link rel="stylesheet" href="/css/datagrid-gap-fix.css?v=4" />
  <!-- Mobile styles must load last to override everything -->

  <script src="/js/icons.js"></script>
  <script>
    (function () {
      const _fetch = window.fetch;
      window.fetch = function (url, opts) {
        return _fetch(url, opts).then(function (r) {
          if (r.status === 401) {
            window.location.href = '/login?expired=1';
            throw new Error('Session expired');
          }
          return r;
        });
      };
    })();
  </script>
  <!-- Apply sidenav state immediately to prevent flash -->
  <script>
    (function() {
      try {
        const storedMode = localStorage.getItem('sidenav-mode') || 'auto';
        function applyState() {
          const sidenav = document.querySelector('.sidenav');
          if (sidenav) {
            sidenav.classList.add('nav-' + storedMode);
            // Enable transitions after state is applied
            setTimeout(function() {
              document.body.classList.add('sidenav-ready');
            }, 10);
          }
        }
        // Apply immediately if DOM is ready, otherwise wait
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', applyState);
        } else {
          applyState();
        }
      } catch (e) {
        // Ignore errors, but still enable transitions
        setTimeout(function() {
          document.body.classList.add('sidenav-ready');
        }, 100);
      }
    })();
  </script>

</head>

<body>
<script>
// Mobile layout fix - runs immediately before DOM is painted
(function(){
  if(window.innerWidth>1024)return;
  document.body.classList.add('is-mobile-view');
  var css=document.createElement('style');
  css.id='mobile-gap-fix';
  css.textContent='@media(max-width:1024px){html,body{height:auto!important;min-height:0!important;overflow-x:hidden!important}.app{display:block!important;height:auto!important;min-height:0!important;max-height:none!important;flex:none!important}main,.content-shell{display:block!important;height:auto!important;min-height:0!important;max-height:none!important;flex:none!important;flex-grow:0!important}.card,.card[data-grid],section.card,[data-grid]{display:block!important;height:auto!important;min-height:0!important;max-height:none!important;flex:none!important}.dg-scroll{display:block!important;height:auto!important;min-height:0!important;border:0!important;border-width:0!important;background:transparent!important;background-color:transparent!important;box-shadow:none!important;padding:0!important;margin:0!important;overflow:visible!important;border-radius:0!important}.dg-table,.dg-table tbody,.dg-table tr,.dg-table td{display:block!important;height:auto!important;min-height:0!important}.dg-table thead,.dg-table colgroup{display:none!important;visibility:hidden!important;height:0!important;position:absolute!important;left:-9999px!important}}';
  document.head.appendChild(css);
})();
</script>