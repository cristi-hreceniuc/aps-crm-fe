<!doctype html>
<html lang="ro">

<head>
  <title>APS CRM</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>
    <%= typeof title !=='undefined' ? title + ' · ' : '' %>APS CRM
  </title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700;800&display=swap"
    rel="stylesheet">

  <link rel="icon" type="image/png" href="/img/aps-logo-small.png" sizes="32x32">
  <link rel="apple-touch-icon" href="/img/aps-logo-small.png">

  <link rel="stylesheet" href="/css/base.css" />
  <link rel="stylesheet" href="/css/layout.css" />
  <link rel="stylesheet" href="/css/sidebar.css" />
  <link rel="stylesheet" href="/css/components.css" />
  <link rel="stylesheet" href="/css/icons.css" />
  <link rel="stylesheet" href="/css/dark-theme.css">

  <!-- DataGrid CSS separat (după components ca să aibă prioritate) -->
  <link rel="stylesheet" href="/css/datagrid.css" />
  <link rel="stylesheet" href="/css/responsive.css" />
  <link rel="stylesheet" href="/css/datagrid.mobile.css" />
  <link rel="stylesheet" href="/css/datagrid-gap-fix.css" />
  <!-- Mobile styles must load last to override everything -->

  <script src="/js/icons.js"></script>
  <script>
    (function () {
      const _fetch = window.fetch;
      window.fetch = function (url, opts) {
        return _fetch(url, opts).then(function (r) {
          if (r.status === 401) {
            window.location.href = '/login?expired=1';
            throw new Error('Session expired');
          }
          return r;
        });
      };
    })();
  </script>
  <!-- Apply sidenav state immediately to prevent flash -->
  <script>
    (function() {
      try {
        const storedMode = localStorage.getItem('sidenav-mode') || 'auto';
        function applyState() {
          const sidenav = document.querySelector('.sidenav');
          if (sidenav) {
            sidenav.classList.add('nav-' + storedMode);
            // Enable transitions after state is applied
            setTimeout(function() {
              document.body.classList.add('sidenav-ready');
            }, 10);
          }
        }
        // Apply immediately if DOM is ready, otherwise wait
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', applyState);
        } else {
          applyState();
        }
      } catch (e) {
        // Ignore errors, but still enable transitions
        setTimeout(function() {
          document.body.classList.add('sidenav-ready');
        }, 100);
      }
    })();
  </script>

</head>

<body>