<%- include('partials/head', { title: 'Setări' }) %>
  <div class="app">
    <%- include('partials/sidenav', { path, isLogged, user }) %>

      <main class="content-shell">
        <header class="content-header">
          <h1>Setări</h1>
          <small class="muted">Preferințe și configurări aplicație</small>
        </header>

        <section class="grid two">
          <div class="card">
            <h2>Setări cont</h2>
            <div style="margin-top:12px;">
              <% if (isLogged) { %>
                <a href="/register" class="btn btn-outline">
                  <svg class="icon-svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" style="width: 1.125rem; height: 1.125rem; margin-right: 0.5rem;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z" />
                  </svg>
                  Creează cont nou
                </a>
                <% } else { %>
                  <p class="muted">Conectează-te pentru a crea conturi noi.</p>
                  <% } %>
            </div>
          </div>

          <div class="card">
            <h2>Preferințe</h2>
            <label class="theme-toggle" style="margin-top:12px;">
              <input type="checkbox" id="darkThemeToggle">
              <span class="slider"></span> Dark Theme
            </label>
          </div>
        </section>

        <!-- ===== Setări XML (borderou 230) ===== -->
        <section class="card xml-settings">
          <h2>Setări XML (Formular 230)</h2>
          <p class="muted" style="margin:8px 0 14px">
            Actualizează valorile folosite la generarea borderourilor (xmlns, schema, lună, an, denumire, CUI, CIF).
          </p>

          <div id="settings-root" class="settings-list">
            <!-- rândurile vin din /js/settings.js -->
          </div>
        </section>

        <!-- ===== Conturi Web (Admin/Voluntar) ===== -->
        <% 
          const isAdmin = user && user.userRole === 'ADMIN';
          const webUsersColumns = [
            { key: 'id',        label: 'ID',          sortable: false, width: '22%' },
            { key: 'firstName', label: 'Prenume',     sortable: true,  width: '12%' },
            { key: 'lastName',  label: 'Nume',        sortable: true,  width: '12%' },
            { key: 'email',     label: 'Email',       sortable: true,  width: '18%' },
            { key: 'role',      label: 'Rol',         sortable: true,  width: '10%' },
            { key: 'status',    label: 'Status',      sortable: true,  width: '10%' },
            { key: 'createdAt', label: 'Data creării', sortable: true, width: '12%', type: 'date' }
          ];
          // Only admins can delete accounts
          if (isAdmin) {
            webUsersColumns.push({ key: '_actions', label: 'Acțiuni', sortable: false, type: 'actions' });
          }
        %>
        <%- include('partials/datagrid', {
          gridId: 'web-users',
          title: 'Conturi Web',
          subtitle: 'Administrează conturile de admin și voluntar',
          searchPlaceholder: 'Caută după nume, email, rol…',

          endpoint: '/api/web-users',

          pageSize: 10,

          api: {
            pageParam: 'page',
            sizeParam: 'size',
            sortParam: 'sort',
            sortValue: '{key},{dir}',
            pageBase: 0,
            searchParam: 'q'
          },
          response: {
            items: 'content',
            page: 'number',
            size: 'size',
            total: 'totalElements'
          },
          extraClass: 'dg-compact',
          columns: webUsersColumns
        }) %>
      </main>
  </div>
  <%- include('partials/footer') %>

    <!-- logica UI pentru setările XML -->
    <script src="/js/settings.js"></script>